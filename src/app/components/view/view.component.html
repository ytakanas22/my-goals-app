<div class="view-header">
  <h2>目標一覧</h2>
  <mat-form-field appearance="fill" class="year-filter">
    <mat-label>表示年</mat-label>
    <mat-select [(ngModel)]="selectedYear" (selectionChange)="loadGoals()">
      @for (year of yearList; track year) {
        <mat-option [value]="year">{{ year }}年</mat-option>
      }
    </mat-select>
  </mat-form-field>
</div>

<div class="goals-grid">
  @for (goal of goals; track goal.id) {
    <mat-card [class.completed]="goal.status === 'completed'">
      <mat-card-header>
        <mat-card-title>{{ goal.title }}</mat-card-title>
        <mat-card-subtitle>期日: {{ goal.deadline | date:'yyyy/MM/dd' }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="progress-section">
          <span class="percentage">{{ goal.progress }}%</span>
          <mat-progress-bar mode="determinate" [value]="goal.progress"></mat-progress-bar>
        </div>
        <p class="description">{{ goal.description }}</p>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-stroked-button (click)="openProgressDialog(goal)">
          <mat-icon>trending_up</mat-icon> 進捗更新
        </button>
        <button mat-icon-button color="warn" (click)="onDelete(goal.id!)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  } @empty {
    <div class="no-data">
      <mat-icon>info</mat-icon>
      <p>表示できる目標がありません。年度の設定や登録を確認してください。</p>
    </div>
  }
</div>